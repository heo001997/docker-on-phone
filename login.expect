#!/usr/bin/expect

set timeout -1
set qemu_pid [lindex $argv 0]

# Wait for the QEMU process to start and be ready for input
sleep 2

# Now, connect to the QEMU monitor console using the PID
spawn -ignore HUP sudo gdb -p $qemu_pid

# Login logic when QEMU presents the login prompt
expect {
  "login:" {
    # Send the root username and a newline character
    send -- "root\r\r"
    expect eof
  }
}

# Hand control over to the user
interact
